<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>replit</title>
  <link href="style.css" rel="stylesheet" type="text/css" />
</head>

<body>
  	<h1 id="title">Crane Operator</h1>
	<div id="error_message_div" hidden=true>
		<p id="error_message_text">Error Message</p>
	</div>
	<h2 id="welcome_message">Welcome Bob Smith, <button class="button-2">Change User?</button></h2>

	<div style="text-align: center;">
		<label for="manifest_import_button" id="manifest_message">Import Manifest: </label>
		<input type="file" id="manifest_import_file" name="Choose File"></input>
	</div>

	<div id="manifest_imported" hidden=true>
		<p>What do you wish to do?</p>

		<button class="button-2" id="balance_ship_button">Balance Ship</button>
		<p/>
		<button class="button-2" id="load_ship_button">Load / Unload crates</button>

		<p/>
		<button class="button-2" id="insert_comment_button" onclick="enter_comment()">Add Comment</button>

		<form action="" onsubmit="return false" method="get" class="submit-comment-form" hidden=true>
			<div class="submit-comment-form"">
				<p for="name">Enter Comment Here:</p>
			    <textarea id="user_comment" maxlength="255"></textarea>
			</div>
			<div class="submit-comment-form"">
			    <input type="submit" value="Submit" onclick="submit_comment()">
				<button onclick="reset_form()">Cancel</button>
			</div>
		</form>
		<p>Ship Layout</p>
		
		<div id="ship_grid_layout">
		</div>


	</div>
</body>

</html>

<script>
	document.getElementById('manifest_import_file').onchange = function() {
		let filepath = document.getElementById('manifest_import_file').value.toString();
		let filedelim = filepath.lastIndexOf('\\');
		if (filedelim == -1) filedelim = filepath.lastIndexOf('/');
		filepath = filepath.substring( filedelim+1 );

		if (manifest_file_err(filepath)) {
			document.getElementById("error_message_div").hidden = false;
			document.getElementById('manifest_imported').hidden = true;
			document.getElementById('manifest_message').innerHTML = "Import Manifest: ";
		}
		else {
			document.getElementById("error_message_div").hidden = true;
			document.getElementById('manifest_imported').hidden = false;
			filepath = filepath.split("_")[2].split(".")[0];
			document.getElementById('manifest_message').innerHTML = "You chose " + filepath;
			document.getElementById('manifest_import_file').name = "Change File?";
		}
		
	};
	function manifest_file_err(filepath) {
		if (filepath.toLowerCase().indexOf("manifest_for_") == -1) {
			console.log(filepath.toLowerCase());
			document.getElementById("error_message_text").innerText = "Please select a valid manifest file (Format = Manifest_for_{ShipName}.txt ) ";
			return true;
		}
		return false;
	}

	function enter_comment() {
		document.getElementsByClassName("submit-comment-form")[0].hidden = false;
	}
	function submit_comment() {
		//Use value here
		console.log(document.getElementById("user_comment").value);
		reset_form();
	}
	function reset_form() {
		document.getElementById("user_comment").value = '';
		document.getElementsByClassName("submit-comment-form")[0].hidden = true;
	}

	document.getElementById("load_ship_button").onclick = function() {
		let filepath = document.getElementById('manifest_import_file').value.toString();
		if (filepath != "")
			window.location='move_crates.html?filepath='+filepath;
	}
	document.getElementById("balance_ship_button").onclick = function() {
		let filepath = document.getElementById('manifest_import_file').value.toString();
		if (document.getElementById('manifest_import_file').value != "")
			window.location='balance.html?filepath='+filepath;
	}
</script>
